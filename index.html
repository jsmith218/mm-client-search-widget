<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://js.jotform.com/JotFormCustomWidget.min.js"></script>

<style>
body {
  font-family: Arial;
  padding: 10px;
}

input {
  width: 100%;
  padding: 10px;
  margin-bottom: 8px;
  font-size: 16px;
}

.result {
  border: 1px solid #ddd;
  padding: 10px;
  margin: 6px 0;
  cursor: pointer;
  border-radius: 6px;
}

.result:hover {
  background: #f0f0f0;
}
</style>

</head>

<body>

<input id="id" placeholder="Client ID (recommended)">
<input id="last" placeholder="Last Name">
<input id="first" placeholder="First Name">

<div id="results"></div>

<script>

// PASTE IT HERE
function jsonp(url) {
  return new Promise((resolve, reject) => {
    const cbName = "cb_" + Math.random().toString(36).slice(2);
    window[cbName] = (data) => {
      try { delete window[cbName]; } catch(e) {}
      script.remove();
      resolve(data);
    };

    const script = document.createElement("script");
    script.src = url + (url.includes("?") ? "&" : "?") + "callback=" + cbName;
    script.onerror = () => {
      try { delete window[cbName]; } catch(e) {}
      script.remove();
      reject(new Error("JSONP request failed"));
    };
    document.body.appendChild(script);
  });
}


const ENDPOINT = "https://script.google.com/macros/s/AKfycbwBIQRPuQJYniRTgE8O_WA4puHLdLEKV_t65Ytiw3NuQOb9IMqTxjpGGhhVnHfifLzx/exec";
function jsonp(url) { /* your jsonp function */ }

const ENDPOINT = "https://script.google.com/macros/s/.../exec";

// âœ… Add this right here:
jsonp(`${ENDPOINT}?id=zzzzzzzz&limit=1`).catch(()=>{});

// your existing listeners + search() below...

let timeout;

document.getElementById("id").addEventListener("input", search);
document.getElementById("last").addEventListener("input", search);
document.getElementById("first").addEventListener("input", search);

function search() {
if (!id && last.length < 2) {
  document.getElementById("results").innerHTML = "";
  return;
}

clearTimeout(timeout);

timeout = setTimeout(async () => {

const id = document.getElementById("id").value.trim();
const last = document.getElementById("last").value.trim();
const first = document.getElementById("first").value.trim();

if (!id && !last) {
  document.getElementById("results").innerHTML = "";
  return;
}

const url =
  `${ENDPOINT}?id=${encodeURIComponent(id)}&last=${encodeURIComponent(last)}&first=${encodeURIComponent(first)}&limit=25`;

const data = await jsonp(url);


render(data.results);

}, 400);

}

function render(results) {

const container = document.getElementById("results");

container.innerHTML = "";

results.forEach(r => {

const div = document.createElement("div");

div.className = "result";

div.innerHTML =
`<b>${r.last}, ${r.first}</b><br>
ID: ${r.id}<br>
# in family: ${r["# in family"]}<br>
${r.address}<br>
Ends: ${r.end}`;

div.onclick = () => select(r);

container.appendChild(div);

});

}

function select(r) {

  const FORM_URL = "https://form.jotform.com/260394523652054";

const qs = new URLSearchParams();
qs.set("client_id", r.id || "");
qs.set("family_size", r["# in family"] || "");
qs.set("first_name", r.first || "");
qs.set("last_name", r.last || "");
qs.set("address", r.address || "");
qs.set("start_date", r.start || "");
qs.set("end_date", r.end || "");

window.top.location.href = `${FORM_URL}?${qs.toString()}`;

}

</script>

</body>
</html>
