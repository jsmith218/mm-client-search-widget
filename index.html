<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://js.jotform.com/JotFormCustomWidget.min.js"></script>

<style>
body {
  font-family: Arial;
  padding: 10px;
}

input {
  width: 100%;
  padding: 10px;
  margin-bottom: 8px;
  font-size: 16px;
}

.result {
  border: 1px solid #ddd;
  padding: 10px;
  margin: 6px 0;
  cursor: pointer;
  border-radius: 6px;
}

.result:hover {
  background: #f0f0f0;
}
</style>

</head>

<body>

<input id="id" placeholder="Client ID (recommended)">
<input id="last" placeholder="Last Name">
<input id="first" placeholder="First Name">

<div id="results"></div>

<script>

const ENDPOINT = "https://script.google.com/macros/s/AKfycbxdv7NaVeYIjbkq8NSFE5hOEqZoM5nxf1amMXeBBwBOGZ1CajEHRrmujZKOuupCApJz/exec";

let timeout;

document.getElementById("id").addEventListener("input", search);
document.getElementById("last").addEventListener("input", search);
document.getElementById("first").addEventListener("input", search);

function search() {

clearTimeout(timeout);

timeout = setTimeout(async () => {

const id = document.getElementById("id").value.trim();
const last = document.getElementById("last").value.trim();
const first = document.getElementById("first").value.trim();

if (!id && !last) {
  document.getElementById("results").innerHTML = "";
  return;
}

const url =
  `${ENDPOINT}?id=${encodeURIComponent(id)}&last=${encodeURIComponent(last)}&first=${encodeURIComponent(first)}&limit=25`;

const response = await fetch(url);
const data = await response.json();

render(data.results);

}, 250);

}

function render(results) {

const container = document.getElementById("results");

container.innerHTML = "";

results.forEach(r => {

const div = document.createElement("div");

div.className = "result";

div.innerHTML =
`<b>${r.last}, ${r.first}</b><br>
ID: ${r.id}<br>
# in family: ${r["# in family"]}<br>
${r.address}<br>
Ends: ${r.end}`;

div.onclick = () => select(r);

container.appendChild(div);

});

}

function select(r) {
  // optional: still copy ID
  navigator.clipboard.writeText(r.id).catch(() => {});

  // ✅ CHANGE THESE to match your prefill URL parameter names
  const FORM_URL = "https://form.jotform.com/260394523652054/prefill/698e01fa353239cb09b03cb286cb"; // your form URL
  const P = {
    uniqueId: "uniqueID",          // <-- replace with real param key
    first: "firstName",            // <-- replace with real param key
    last: "lastName",              // <-- replace with real param key
    family: "family",              // <-- replace with real param key
    address: "address",            // <-- replace with real param key
    start: "startDate",            // <-- replace with real param key
    end: "endDate"                 // <-- replace with real param key
  };

  const qs = new URLSearchParams();
  qs.set(P.uniqueId, r.id || "");
  qs.set(P.first, r.first || "");
  qs.set(P.last, r.last || "");
  qs.set(P.family, r["# in family"] || "");
  qs.set(P.address, r.address || "");
  qs.set(P.start, r.start || "");
  qs.set(P.end, r.end || "");

  // ✅ In the Jotform app / iframe context, top-level redirect is usually needed
  window.top.location.href = `${FORM_URL}?${qs.toString()}`;
}



</script>

</body>
</html>
