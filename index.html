<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://js.jotform.com/JotFormCustomWidget.min.js"></script>

<style>
body {
  font-family: Arial;
  padding: 10px;
}

input {
  width: 100%;
  padding: 10px;
  margin-bottom: 8px;
  font-size: 16px;
}

.result {
  border: 1px solid #ddd;
  padding: 10px;
  margin: 6px 0;
  cursor: pointer;
  border-radius: 6px;
}

.result:hover {
  background: #f0f0f0;
}
</style>

</head>

<body>

<input id="id" placeholder="Client ID (recommended)">
<input id="last" placeholder="Last Name">
<input id="first" placeholder="First Name">

<div id="results"></div>

<script>

const ENDPOINT = "https://script.google.com/macros/s/AKfycbxdv7NaVeYIjbkq8NSFE5hOEqZoM5nxf1amMXeBBwBOGZ1CajEHRrmujZKOuupCApJz/exec";

let timeout;

document.getElementById("id").addEventListener("input", search);
document.getElementById("last").addEventListener("input", search);
document.getElementById("first").addEventListener("input", search);

function search() {

clearTimeout(timeout);

timeout = setTimeout(async () => {

const id = document.getElementById("id").value.trim();
const last = document.getElementById("last").value.trim();
const first = document.getElementById("first").value.trim();

if (!id && !last) {
  document.getElementById("results").innerHTML = "";
  return;
}

const url =
  `${ENDPOINT}?id=${encodeURIComponent(id)}&last=${encodeURIComponent(last)}&first=${encodeURIComponent(first)}&limit=25`;

const response = await fetch(url);
const data = await response.json();

render(data.results);

}, 250);

}

function render(results) {

const container = document.getElementById("results");

container.innerHTML = "";

results.forEach(r => {

const div = document.createElement("div");

div.className = "result";

div.innerHTML =
`<b>${r.last}, ${r.first}</b><br>
ID: ${r.id}<br>
# in family: ${r["# in family"]}<br>
${r.address}<br>
Ends: ${r.end}`;

div.onclick = () => select(r);

container.appendChild(div);

});

}

function select(r) {

  const FORM_URL = "https://form.jotform.com/260394523652054";

  // These are the exact parameter names Jotform expects
  const params = new URLSearchParams();

  params.set("clientID", r.id || "");
  params.set("inFamily", r["# in family"] || "");
  params.set("firstName", r.first || "");
  params.set("lastName", r.last || "");
  params.set("address", r.address || "");
  params.set("startDate", r.start || "");
  params.set("endDate", r.end || "");

  // Redirect entire app to prefilled form
  window.top.location.href = FORM_URL + "?" + params.toString();
}




</script>

</body>
</html>
